<script>
  var qtyarr = Fastify.widgets['qty-breaks']['product_break']
  var qtylastElement = qtyarr.pop();

  if(qtylastElement.breaks === undefined) {
    qtylastElement.breaks = [];
  }

  var block_setting = {{ block.settings | json }};
  {% if block.settings.product_break_free_product %}
    block_setting.free_product = {{ all_products[block.settings.product_break_free_product] | json }};
  {% endif %}

  qtylastElement.breaks.push(block_setting);
  Fastify.widgets['qty-breaks']['product_break'].push(qtylastElement);
</script>

{% schema %}
{
  "name": "t:blocks.quantity_breaks.blocks.product_break.name",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "t:general.settings.block-name.label",
      "info": "t:general.settings.block-name.info"
    },
    {
      "type": "range",
      "id": "product_break_range",
      "label": "t:blocks.quantity_breaks.blocks.product_break.settings.range.label",
      "min": 2,
      "max": 20,
      "step": 1,
      "default": 2,
      "info": "t:blocks.quantity_breaks.blocks.product_break.settings.range.info"
    },
    {
      "type": "text",
      "id": "title",
      "label": "t:blocks.quantity_breaks.blocks.cart_break.settings.qty_text_label",
      "info": "t:blocks.quantity_breaks.blocks.cart_break.settings.qty_text_info"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "t:blocks.quantity_breaks.blocks.cart_break.settings.qty_subtext_label",
      "info": "t:blocks.quantity_breaks.blocks.cart_break.settings.qty_subtext_info"
    },
    {
      "type": "header",
      "content": "t:blocks.quantity_breaks.blocks.product_break.settings.badge_style.name"
    },
    {
      "type": "select",
      "id": "product_break_badge_style",
      "label": "t:blocks.quantity_breaks.blocks.product_break.settings.badge_style.label",
      "default": "simple",
      "options": [
        {
          "value": "simple",
          "label": "t:blocks.quantity_breaks.blocks.product_break.settings.badge_style.options__1"
        },
        {
          "value": "most_popular",
          "label": "t:blocks.quantity_breaks.blocks.product_break.settings.badge_style.options__2"
        }
      ]
    },
    {
      "type": "text",
      "id": "badge_title",
      "label": "t:blocks.quantity_breaks.blocks.product_break.settings.badge_title.label",
      "default": "t:blocks.quantity_breaks.blocks.product_break.settings.badge_title.default",
      "info": "t:blocks.quantity_breaks.blocks.product_break.settings.badge_title.info"
    },
    {
      "type": "header",
      "content": "Free product"
    },
    {
      "type": "image_picker",
      "id": "product_break_free_product_image",
      "label": "t:blocks.quantity_breaks.blocks.product_break.settings.free_product.free_product_img.label",
      "info": "t:blocks.quantity_breaks.blocks.product_break.settings.free_product.free_product_img.info"
    },
    {
      "type": "product",
      "id": "product_break_free_product",
      "label": "t:blocks.quantity_breaks.blocks.product_break.settings.free_product.free_product.label",
      "info": "t:blocks.quantity_breaks.blocks.product_break.settings.free_product.free_product.info"
    },
    {
      "type": "range",
      "id": "product_break_free_product_quantity",
      "label": "t:blocks.quantity_breaks.blocks.cart_break.settings.free_qty_label",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 1,
      "info": "t:blocks.quantity_breaks.blocks.cart_break.settings.free_qty_info"
    },
    {
      "type": "header",
      "content": "t:general.settings.discount.header.content",
      "info": "t:general.settings.discount.header.info_1"
    },
    {
      "type": "text",
      "id": "product_break_discount_code",
      "label": "t:general.settings.discount.name.label"
    },
    {
      "type": "text",
      "id": "product_break_discount_amount",
      "label": "t:general.settings.discount.amount.label"
    },
    {
      "type": "select",
      "id": "product_break_discount_type",
      "label": "t:general.settings.discount.type.label",
      "default": "%",
      "options": [
        {
          "value": "%",
          "label": "t:general.settings.discount.type.options__1.label"
        },
        {
          "value": "$",
          "label": "t:general.settings.discount.type.options__2.label"
        }
      ]
    },
    {
      "type": "text",
      "id": "product_break_tag_1",
      "label": "Tag"
    },
    {
      "type": "color",
      "id": "product_break_tag_1_background_color",
      "label": "Background color",
      "default": "#F2F0FF"
    },
    {
      "type": "color",
      "id": "product_break_tag_1_text_color",
      "label": "Text color",
      "default": "#7559FF"
    },
    {
      "type": "color",
      "id": "product_break_tag_1_border_color",
      "label": "Border color",
      "default": "#7559FF"
    }
  ],
  "presets": [
    {
      "name": "t:blocks.quantity_breaks.blocks.cart_break.settings.item.content"
    }
  ]
}
{% endschema %}
